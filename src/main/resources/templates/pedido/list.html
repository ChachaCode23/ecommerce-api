<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(
          pageTitle='Gestión de Pedidos',
          breadcrumb='Pedidos / Listado',
          contentFragment=~{::content}
      )}">
<body>
<div th:fragment="content">
    <!-- Mensajes -->
    <div th:replace="~{messages :: messages}"></div>

    <div class="pedidos-list">
        <!-- Botón para crear nuevo pedido -->
        <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
            <h3 class="card-title">Listado de Pedidos</h3>
            <a th:href="@{/web/pedidos/create}" class="btn btn-primary">
                <svg style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 5px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                </svg>
                Crear Nuevo Pedido
            </a>
        </div>

        <!-- Tabla de pedidos -->
        <div th:if="${pedidos != null and !pedidos.isEmpty()}">
            <table>
                <thead>
                    <tr>
                        <th>ID</th>
                        <th>USUARIO</th>
                        <th>DIRECCIÓN</th>
                        <th>ESTADO</th>
                        <th>MÉTODO PAGO</th>
                        <th>CANTIDAD</th>
                        <th>TOTAL</th>
                        <th>ACCIONES</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="pedido : ${pedidos}">
                        <td>
                            <strong th:text="'#' + ${pedido.id}">#001</strong>
                        </td>
                        <td th:text="${pedido.usuario != null ? pedido.usuario.nombre : 'N/A'}">Usuario 1</td>
                        <td th:text="${pedido.direccionEnvioId != null ? 'Dirección ' + pedido.direccionEnvioId : 'N/A'}">Dirección 1</td>
                        <td>
                            <span th:text="${pedido.estado}" 
                                  style="padding: 6px 12px; border-radius: 12px; font-size: 12px; font-weight: 500; display: inline-block;"
                                  th:style="${pedido.estado.name() == 'COMPLETADO' ? 'background: #10b981; color: #ffffff;' : 
                                             pedido.estado.name() == 'ENVIADO' ? 'background: #3b82f6; color: #ffffff;' :
                                             pedido.estado.name() == 'PENDIENTE_PAGO' ? 'background: #f59e0b; color: #ffffff;' : 
                                             pedido.estado.name() == 'PAGADO' ? 'background: #10b981; color: #ffffff;' :
                                             pedido.estado.name() == 'CANCELADO' ? 'background: #ef4444; color: #ffffff;' :
                                             'background: #6b7280; color: #ffffff;'}">
                                Estado
                            </span>
                        </td>
                        <td th:text="${pedido.metodoPago != null ? pedido.metodoPago : 'N/A'}">N/A</td>
                        <td style="text-align: center;">
                            <strong th:text="${pedido.cantidadTotal != null ? pedido.cantidadTotal + ' items' : '0 items'}">0 items</strong>
                        </td>
                        <td>
                            <strong th:text="${'$' + #numbers.formatDecimal(pedido.total, 1, 2)}">$0.00</strong>
                        </td>
                        <td>
                            <a th:href="@{/web/pedidos/{id}(id=${pedido.id})}" 
                               class="btn btn-secondary" 
                               style="padding: 6px 12px; font-size: 12px; margin-right: 5px;">
                                Ver Detalle
                            </a>
                        </td>
                    </tr>
                </tbody>
            </table>
        </div>

        <!-- Mensaje cuando no hay pedidos -->
        <div th:if="${pedidos == null or pedidos.isEmpty()}" 
             style="text-align: center; padding: 60px 20px; color: #6b7280; background: #f9fafb; border-radius: 8px;">
            <svg style="width: 80px; height: 80px; margin: 0 auto 20px; opacity: 0.4;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5H7a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2V7a2 2 0 00-2-2h-2M9 5a2 2 0 002 2h2a2 2 0 002-2M9 5a2 2 0 012-2h2a2 2 0 012 2"/>
            </svg>
            <h3 style="font-size: 18px; margin-bottom: 10px; color: #4b5563;">No hay pedidos registrados</h3>
            <p style="margin-bottom: 20px;">Comienza creando tu primer pedido</p>
            <a th:href="@{/web/pedidos/create}" class="btn btn-primary">Crear Pedido</a>
        </div>
    </div>

    <!-- Script para auto-ocultar mensajes -->
    <script th:replace="~{messages :: auto-hide-messages}"></script>
</div>
</body>
</html>