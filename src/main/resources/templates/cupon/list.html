<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(
          pageTitle='Gestión de Cupones',
          breadcrumb='Cupones / Listado',
          contentFragment=~{::content}
      )}">
<body>
<div th:fragment="content">
    <!-- Mensajes -->
    <div th:replace="~{messages :: messages}"></div>

    <!-- Botón crear -->
    <div style="margin-bottom: 20px; display: flex; justify-content: space-between; align-items: center;">
        <h3 class="card-title">Cupones de Descuento</h3>
        <a th:href="@{/web/cupones/create}" class="btn btn-primary">
            <svg style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 5px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
            </svg>
            Nuevo Cupón
        </a>
    </div>

    <!-- Tabla de cupones -->
    <div th:if="${cupones != null and !cupones.isEmpty()}">
        <table>
            <thead>
                <tr>
                    <th>ID</th>
                    <th>Código</th>
                    <th>Tipo</th>
                    <th>Descuento</th>
                    <th>Mínimo</th>
                    <th>Estado</th>
                    <th>Vigencia</th>
                    <th>Acciones</th>
                </tr>
            </thead>
            <tbody>
                <tr th:each="cupon : ${cupones}">
                    <td><strong th:text="'#' + ${cupon.id}">#1</strong></td>
                    <td>
                        <strong th:text="${cupon.codigo}" style="font-family: monospace; font-size: 13px;">CODE</strong>
                    </td>
                    <td>
                        <span th:text="${cupon.tipo}" 
                              style="padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;"
                              th:style="${cupon.tipo.name() == 'PORCENTAJE' ? 'background: #dbeafe; color: #1e40af;' : 
                                        'background: #fef3c7; color: #92400e;'}">
                            TIPO
                        </span>
                    </td>
                    <td>
                        <strong th:if="${cupon.tipo.name() == 'PORCENTAJE'}" 
                                th:text="${cupon.valorDescuento + '%'}">10%</strong>
                        <strong th:if="${cupon.tipo.name() == 'MONTO_FIJO'}" 
                                th:text="${'$' + #numbers.formatDecimal(cupon.valorDescuento, 1, 2)}">$10.00</strong>
                    </td>
                    <td th:text="${cupon.minimoCompra != null ? '$' + #numbers.formatDecimal(cupon.minimoCompra, 1, 2) : '-'}">-</td>
                    <td>
                        <span th:text="${cupon.activo ? 'Activo' : 'Inactivo'}" 
                              style="padding: 4px 10px; border-radius: 12px; font-size: 11px; font-weight: 600;"
                              th:style="${cupon.activo ? 'background: #d1fae5; color: #065f46;' : 
                                        'background: #fee2e2; color: #991b1b;'}">
                            Estado
                        </span>
                    </td>
                    <td style="font-size: 12px;">
                        <!-- Verificar si está expirado -->
                        <div th:if="${cupon.fechaFin != null and #temporals.createNow().isAfter(cupon.fechaFin)}" 
                             style="padding: 4px 10px; background: #fee2e2; color: #991b1b; border-radius: 6px; margin-bottom: 5px; font-weight: 600;">
                            ⚠ EXPIRADO
                        </div>
                        
                        <div th:if="${cupon.fechaInicio != null}">
                            <span style="color: #6b7280;">Desde:</span>
                            <span th:text="${#temporals.format(cupon.fechaInicio, 'dd/MM/yyyy')}">01/01/2025</span>
                        </div>
                        <div th:if="${cupon.fechaFin != null}">
                            <span style="color: #6b7280;">Hasta:</span>
                            <span th:text="${#temporals.format(cupon.fechaFin, 'dd/MM/yyyy')}" 
                                  th:style="${#temporals.createNow().isAfter(cupon.fechaFin) ? 'color: #991b1b; font-weight: 600;' : ''}">31/12/2025</span>
                        </div>
                        <span th:if="${cupon.fechaInicio == null and cupon.fechaFin == null}" style="color: #059669; font-weight: 500;">Sin límite</span>
                    </td>
                    <td>
                        <div style="display: flex; gap: 8px;">
                            <a th:href="@{/web/cupones/{id}/edit(id=${cupon.id})}" 
                               class="btn btn-secondary" 
                               style="padding: 6px 12px; font-size: 12px;">
                                Editar
                            </a>
                            <form th:action="@{/web/cupones/{id}/delete(id=${cupon.id})}" 
                                  method="post" 
                                  style="margin: 0;"
                                  onsubmit="return confirm('¿Está seguro de eliminar este cupón?');">
                                <button type="submit" 
                                        class="btn btn-danger" 
                                        style="padding: 6px 12px; font-size: 12px;">
                                    Eliminar
                                </button>
                            </form>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
    </div>

    <!-- Mensaje cuando no hay cupones -->
    <div th:if="${cupones == null or cupones.isEmpty()}" 
         style="text-align: center; padding: 60px 20px; color: #6b7280; background: #f9fafb; border-radius: 8px;">
        <svg style="width: 80px; height: 80px; margin: 0 auto 20px; opacity: 0.4;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z"/>
        </svg>
        <h3 style="font-size: 18px; margin-bottom: 10px; color: #4b5563;">No hay cupones registrados</h3>
        <p style="margin-bottom: 20px;">Comienza creando tu primer cupón de descuento</p>
        <a th:href="@{/web/cupones/create}" class="btn btn-primary">Crear Cupón</a>
    </div>

    <!-- Script para auto-ocultar mensajes -->
    <script th:replace="~{messages :: auto-hide-messages}"></script>
</div>
</body>
</html>