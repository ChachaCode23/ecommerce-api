<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout :: layout(
          pageTitle='Crear Producto',
          breadcrumb='Productos / Crear Nuevo',
          contentFragment=~{::content}
      )}">
<body>
<div th:fragment="content">
    <!-- Mensajes -->
    <div th:replace="~{messages :: messages}"></div>

    <!-- Botón volver -->
    <div style="margin-bottom: 20px;">
        <a th:href="@{/web/productos}" class="btn btn-secondary">
            <svg style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 5px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 19l-7-7m0 0l7-7m-7 7h18"/>
            </svg>
            Volver al Catálogo
        </a>
    </div>

    <h3 class="card-title">Crear Nuevo Producto</h3>

    <!-- Formulario -->
    <form th:action="@{/web/productos/create}" method="post" id="formCrearProducto" onsubmit="return validarFormulario()">
        
        <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 20px;">
            <!-- Nombre -->
            <div class="form-group">
                <label for="nombre">
                    Nombre del Producto <span style="color: #ef4444;">*</span>
                </label>
                <input type="text" 
                       id="nombre"
                       name="nombre" 
                       th:value="${nombre}" 
                       required
                       minlength="3"
                       maxlength="100"
                       placeholder="Ej: Camisa Polo Azul">
                <small style="color: #6b7280; font-size: 12px;">Mínimo 3 caracteres</small>
            </div>

            <!-- Precio -->
            <div class="form-group">
                <label for="precio">
                    Precio <span style="color: #ef4444;">*</span>
                </label>
                <input type="number" 
                       id="precio"
                       name="precio" 
                       th:value="${precio}" 
                       required
                       min="0.01"
                       step="0.01"
                       placeholder="0.00">
                <small style="color: #6b7280; font-size: 12px;">Ingrese el precio en dólares</small>
            </div>
        </div>

        <!-- Descripción -->
        <div class="form-group">
            <label for="descripcion">
                Descripción <span style="color: #6b7280;">(opcional)</span>
            </label>
            <textarea id="descripcion"
                      name="descripcion" 
                      rows="4"
                      maxlength="500"
                      placeholder="Describe las características del producto..."
                      th:text="${descripcion}"></textarea>
            <small style="color: #6b7280; font-size: 12px;">Máximo 500 caracteres</small>
        </div>

        <!-- Stock -->
        <div class="form-group">
            <label for="stock">
                Stock Inicial <span style="color: #ef4444;">*</span>
            </label>
            <input type="number" 
                   id="stock"
                   name="stock" 
                   th:value="${stock}" 
                   required
                   min="0"
                   placeholder="0">
            <small style="color: #6b7280; font-size: 12px;">Cantidad disponible en inventario</small>
        </div>

        <!-- Botones -->
        <div style="margin-top: 30px; display: flex; gap: 10px;">
            <button type="submit" class="btn btn-success">
                <svg style="width: 16px; height: 16px; display: inline-block; vertical-align: middle; margin-right: 5px;" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/>
                </svg>
                Crear Producto
            </button>
            <a th:href="@{/web/productos}" class="btn btn-secondary">Cancelar</a>
        </div>
    </form>

    <!-- Script de validación -->
    <script>
        function validarFormulario() {
            const errorMessages = document.querySelectorAll('.error-message');
            errorMessages.forEach(msg => msg.remove());

            let esValido = true;

            // Validar Nombre
            const nombre = document.getElementById('nombre');
            if (!nombre.value || nombre.value.trim().length < 3) {
                mostrarError(nombre, 'El nombre debe tener al menos 3 caracteres');
                esValido = false;
            }

            // Validar Precio
            const precio = document.getElementById('precio');
            if (!precio.value || parseFloat(precio.value) <= 0) {
                mostrarError(precio, 'El precio debe ser mayor a 0');
                esValido = false;
            }

            // Validar Stock
            const stock = document.getElementById('stock');
            if (!stock.value || parseInt(stock.value) < 0) {
                mostrarError(stock, 'El stock no puede ser negativo');
                esValido = false;
            }

            if (!esValido) {
                const primerError = document.querySelector('.error-message');
                if (primerError) {
                    primerError.scrollIntoView({ behavior: 'smooth', block: 'center' });
                }
            }

            return esValido;
        }

        function mostrarError(input, mensaje) {
            input.style.borderColor = '#ef4444';
            
            const errorDiv = document.createElement('div');
            errorDiv.className = 'error-message';
            errorDiv.style.color = '#ef4444';
            errorDiv.style.fontSize = '12px';
            errorDiv.style.marginTop = '5px';
            errorDiv.textContent = mensaje;
            
            input.parentNode.appendChild(errorDiv);
        }

        // Limpiar errores al escribir
        document.querySelectorAll('input, textarea').forEach(input => {
            input.addEventListener('input', function() {
                this.style.borderColor = '';
                const errorMsg = this.parentNode.querySelector('.error-message');
                if (errorMsg) {
                    errorMsg.remove();
                }
            });
        });
    </script>

    <!-- Script para auto-ocultar mensajes -->
    <script th:replace="~{messages :: auto-hide-messages}"></script>
</div>
</body>
</html>